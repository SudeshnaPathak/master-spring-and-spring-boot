#Multi Stage Dockerfile
#Stage 1 : Build Stage
#Use Maven to build the jar files inside the Docker image itself
FROM maven:3.9.11-amazoncorretto-25-alpine AS build

#Set working directory inside the image to /home/app
WORKDIR /home/app

#Copy all files from current directory to /home/app inside the image
COPY . /home/app

#Run mvn clean package to build the jar files
RUN mvn -f /home/app/pom.xml clean package

#At the end of the build stage, we will have the jar files inside /home/app/target directory of the image

#Stage 2 : Run Stage
#Set base image to OpenJDK 25 slim version
FROM openjdk:25-ea-jdk-slim

#Informs Docker that the container listens on port 5000 at runtime
EXPOSE 5000

#Copy the built jar files from the build stage from home/app/target directory to the current stage and names it app.jar
COPY --from=build /home/app/target/*.jar app.jar
ENTRYPOINT [ "sh", "-c", "java -jar /app.jar" ]


#docker build -f Dockerfile2 -t in28min/hello-world-docker:v2 .
#docker run -d -p 5000:5000 in28min/hello-world-docker:v2

#ADVANTAGE ~ Build doesn't make use of anything built in the local machine
#DISADVANTAGE ~ Build stage makes the overall build time longer as it has to build the jars inside the image itself